---
title: "TSO monitor"
editor_options: 
  chunk_output_type: console
---
```{r setup, include=FALSE}
library(googledrive)
library(googlesheets4)
library(tidyverse)
library(gt)
library(htmltools)
library(reactable)

gs4_auth(path = Sys.getenv("GOOGLE_SHEETS_AUTH_FILE"))
sheet_url <- "https://docs.google.com/spreadsheets/d/1wUMj9zsxa-eFd8F_XLyCbE7ZMsENwgH1cNq_0tXUHO0/edit?gid=0#gid=0"
tab1_data0 <- read_sheet(sheet_url, sheet = 'Governance', range = "A1:I33")
tab2_data0 <- read_sheet(sheet_url, sheet = 'Politics', range = "A1:I33")

tab1_data <- tab1_data0 %>%
  select(-`Ownership (detailed)`) %>% 
  group_by(Country) %>%
  mutate(row_id = row_number()) %>%
  ungroup()

tab2_data <- tab2_data0 %>%
  group_by(Country) %>%
  mutate(row_id = row_number()) %>%
  ungroup()
```

# Governance {data-orientation=rows}

## Row 1
```{r}
reactable(
  tab1_data,
  columns = list(
    Country = colDef(
      minWidth = 60,
      sticky = "left",
      style = function(value, index) {
        current_country <- tab1_data$Country[index]
        if (index > 1) {
          previous_country <- tab1_data$Country[index - 1]
          if (current_country == previous_country) {
            list(borderTop = "none", paddingTop = 0, paddingBottom = 0, color = "transparent")
          } else {
            list(fontWeight = "bold")
          }
        } else {
          list(fontWeight = "bold")
        }
      },
      cell = function(value, index) {
        current_country <- tab1_data$Country[index]
        if (index > 1) {
          previous_country <- tab1_data$Country[index - 1]
          if (current_country == previous_country) {
            value <- ""
          }
        }
        value
      }
    ),
    TSO = colDef(minWidth = 40,
      cell = function(value, index) {
        url <- tab1_data$TSO_URL[index]
        if (!is.na(url)) {
          htmltools::tags$a(href = url, target = "_blank", value)
        } else {
          value
        }
      }
    ),
    "State ownership share" = colDef(
      minWidth = 40,
      format = colFormat(
        percent = TRUE,
        digits = 1
      )
    ),
    TSO_URL = colDef(show = FALSE),
    row_id = colDef(show = FALSE)
  ),
  theme = reactableTheme(
    borderColor = "#dfe2e5",
    stripedColor = "#f6f8fa",
    highlightColor = "#f0f5f9",
    cellPadding = "8px 12px"
  ),
  pagination = FALSE
)
```

# Politics {data-orientation=rows}

## Row 1 
```{r}
reactable(
  tab2_data,
  columns = list(
    "Country" = colDef(
      minWidth = 120,
      sticky = "left",
      style = function(value, index) {
        current_country <- tab2_data$Country[index]
        if (index > 1) {
          previous_country <- tab2_data$Country[index - 1]
          if (current_country == previous_country) {
            list(borderTop = "none", paddingTop = 0, paddingBottom = 0, color = "transparent")
          } else {
            list(fontWeight = "bold")
          }
        } else {
          list(fontWeight = "bold")
        }
      },
      cell = function(value, index) {
        current_country <- tab2_data$Country[index]
        if (index > 1) {
          previous_country <- tab2_data$Country[index - 1]
          if (current_country == previous_country) {
            value <- ""
          }
        }
        value
      }
    ),
    "TSO" = colDef(
      minWidth = 100,
      sticky = "left"
    ),
    "Current share of renewables (%) 2022 Ember" = colDef(
      minWidth = 150,
      headerStyle = list(whiteSpace = "pre-wrap", lineHeight = "1.2")
    ),
    "Government aligned with 2035 benchmark" = colDef(
      minWidth = 150,
      headerStyle = list(whiteSpace = "pre-wrap", lineHeight = "1.2")
    ),
    "Green Grids Initiative (GGI)" = colDef(
      minWidth = 150,
      headerStyle = list(whiteSpace = "pre-wrap", lineHeight = "1.2")
    ),
    "International Smart Grid Action Network (ISGAN)" = colDef(
      minWidth = 150,
      headerStyle = list(whiteSpace = "pre-wrap", lineHeight = "1.2")
    ),
    "Global Power System Transformation Consortium (G-PST)" = colDef(
      minWidth = 150,
      headerStyle = list(whiteSpace = "pre-wrap", lineHeight = "1.2")
    ),
    "Regulatory Energy Transition Accelerator (RETA)" = colDef(
      minWidth = 150,
      headerStyle = list(whiteSpace = "pre-wrap", lineHeight = "1.2")
    ),
    "Breakthrough Agenda Power (P4 infrastructure, knowledge, capacity & skills)" = colDef(
      minWidth = 150,
      headerStyle = list(whiteSpace = "pre-wrap", lineHeight = "1.2")
    ),
    "Clean Energy Ministerial" = colDef(
      minWidth = 150,
      headerStyle = list(whiteSpace = "pre-wrap", lineHeight = "1.2")
    ),
    "ENTSO-E board member or head of Assembly" = colDef(
      minWidth = 150,
      headerStyle = list(whiteSpace = "pre-wrap", lineHeight = "1.2")
    ),
    "ENTSO-E committee chair" = colDef(
      minWidth = 150,
      headerStyle = list(whiteSpace = "pre-wrap", lineHeight = "1.2")
    ),
    "row_id" = colDef(show = FALSE)
  ),
  theme = reactableTheme(
    borderColor = "#dfe2e5",
    stripedColor = "#f6f8fa",
    highlightColor = "#f0f5f9",
    cellPadding = "8px 12px"
  ),
  pagination = FALSE,
  compact = TRUE
)
```