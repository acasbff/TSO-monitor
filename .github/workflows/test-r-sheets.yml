name: Test R Google Sheets

on:
  workflow_dispatch:

jobs:
  test-r-sheets:
    runs-on: ubuntu-latest
    
    steps:
      - uses: actions/checkout@v3
      
      - uses: r-lib/actions/setup-r@v2
        with:
          r-version: '4.2.0'
          
      - name: Install minimal required packages
        run: |
          install.packages(c('googlesheets4', 'tidyverse'), repos = 'https://cloud.r-project.org')
        shell: Rscript {0}
          
      - name: Set up Google Sheets credentials
        run: |
          echo '${{ secrets.GOOGLE_SHEETS_CREDENTIALS }}' > gs-creds.json
          
      - name: Test Google Sheets connection
        run: Rscript test_sheets.R
        env:
          GOOGLE_SHEETS_AUTH_FILE: gs-creds.json